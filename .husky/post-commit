# 获取最新提交的签名状态
LATEST_COMMIT=$(git rev-parse HEAD)
SIGNATURE=$(git verify-commit $LATEST_COMMIT 2>&1)

if [ "$OSTYPE" = "msys" ] || [ "$OSTYPE" = "win32" ] || [ "$OSTYPE" = "cygwin" ]; then
    # Windows 系统
    echo "$SIGNATURE" | find "无法验证签名" > nul 2>&1
    if [ $? -eq 0 ]; then
        echo "警告: 最新提交未正确签名"
        echo "提交哈希: $LATEST_COMMIT"
        echo "请检查你的 GPG 配置是否正确"
        exit 1
    fi
else
    # Unix-like 系统
    if echo "$SIGNATURE" | grep -q "无法验证签名"; then
        echo "警告: 最新提交未正确签名"
        echo "提交哈希: $LATEST_COMMIT"
        echo "请检查你的 GPG 配置是否正确"
        exit 1
    fi
fi

echo "最新提交已正确签名 ✓"